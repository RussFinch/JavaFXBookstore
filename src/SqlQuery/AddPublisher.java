package SqlQuery;

import Database.DbConnection;
import Database.UpdatesConnection;
import java.io.FileNotFoundException;
import java.util.ArrayList;

/**
 * This class builds add publisher query from data
 * generated by add publisher interface.
 * @author russellfincham
 * @version 0.1
 * @since 13-07-18
 */

public class AddPublisher {
    /**
     * This method generates SQL For a publisher addition.
     * It generates the query which it then passes to the
     * database connection manager DbConnection.Manager. Results then
     * returned to AddPublisherController.btnPubAddAction method for
     * the add Publisher Interface.
     * Data validity checking handled before execution of INSERT.
     * @param pubId ID of publisher to be added
     * @param pubName Name of Publisher to be added
     * @param pubPostcode Postcode of publisher to be added
     * @param pubAddress1 address of publisher to be added
     * @param pubAddress2 address of publisher to be added
     * @param pubAddress3 address of publisher to be added
     * @param pubTown Town of publisher to be added
     * @param pubCounty county of publisher to be added
     * @throws FileNotFoundException if file cannot be accessed by
     * DbCredentials.DbUser().
     * @return String result of SQL transaction.
     */
    public static String Query(String pubId, String pubName, String pubPostcode,
                               String pubAddress1, String pubAddress2, String pubAddress3,
                               String pubTown, String pubCounty)
            throws FileNotFoundException {

        String result;

        String sqlTestID = "SELECT 1 FROM publishers WHERE publisher_id = '"
                + pubId + "' LIMIT 1;";

        String sqlQuery = "INSERT INTO publishers VALUES "
                + "('" + pubId + "', '"
                + pubName + "', '"
                + pubAddress1 + "', '"
                + pubAddress2 + "', '"
                + pubAddress3 + "', '"
                + pubTown + "', '"
                + pubCounty + "', '"
                + pubPostcode + "');";

        ArrayList<String[]> pubIdTest = new ArrayList<>(DbConnection.Manager(sqlTestID));

        if (pubIdTest.get(0)[0].equals("1")) {
            result = "Publisher ID already in use.";
        }
        else {
            result = UpdatesConnection.queryDatabase(sqlQuery);
        }

        return result;
    }
}